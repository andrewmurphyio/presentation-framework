# Implementation Plan

Generated by Ralph Wiggum planning loop - Iteration 2 (MVP-focused)

## Project Status

**Current State:** Greenfield project with complete specifications, zero implementation

**Specifications Analyzed:**
- âœ… slide-authoring.md
- âœ… talk-metadata.md
- âœ… design-system.md
- âœ… animations.md
- âœ… talk-variants.md
- âœ… theming.md
- âœ… media.md
- âœ… output-rendering.md

**Strategy:** Build incrementally with working vertical slices, not all features at once.

---

## Phase 1: MVP - Single Static Slide with Theme (Priority 1)

**Goal:** Render one HTML slide with a theme applied in a browser. Proves the core architecture works.

**Deliverable:** A static HTML page showing a title slide with themed colors/fonts.

### Infrastructure & Tooling

âœ… **Initialize package.json**
- Define name: "presentation-framework", version: "0.1.0"
- Set type: "module" for ESM support
- Scripts: dev, build, test, lint, format
- **Write tests:** N/A (configuration file)

âœ… **Install and configure TypeScript**
- Install typescript as devDependency
- Create tsconfig.json with strict mode, ESM output
- Configure paths: `@/*` â†’ `src/*`
- Target: ES2020, module: ESNext
- **Write tests:** N/A (configuration file)

âœ… **Install and configure Vitest**
- Install vitest, @vitest/ui, jsdom
- Create vitest.config.ts
- Configure test patterns: `**/*.{test,spec}.ts`
- Enable coverage reporting
- **Write tests:** N/A (configuration file)

âœ… **Install and configure ESLint + Prettier**
- Install eslint, prettier, @typescript-eslint/*
- Create .eslintrc.json with strict rules
- Create .prettierrc (2 spaces, single quotes, trailing commas)
- Add lint/format scripts
- **Write tests:** N/A (configuration file)

âœ… **Install and configure Vite**
- Install vite
- Create vite.config.ts for library mode
- Configure build output: dist/
- Set up dev server on port 5173
- **Write tests:** N/A (configuration file)

âœ… **Create directory structure**
- src/lib/types/
- src/lib/design-system/
- src/lib/theming/
- tests/
- **Write tests:** N/A (setup task)

### Minimal Type Definitions

âœ… **Define design token types (src/lib/types/tokens.ts)**
- ColorTokens interface
- TypographyTokens interface
- SpacingTokens interface
- DesignTokens interface (combines all token types)
- **Write tests:** Type compilation tests

âœ… **Define theme types (src/lib/types/theme.ts)**
- Theme interface (implements DesignTokens)
- **Write tests:** Type compilation tests

âœ… **Define layout types (src/lib/types/layout.ts)**
- LayoutZone interface
- LayoutDefinition interface
- For now: just support "title" layout
- **Write tests:** Type compilation tests

âœ… **Define slide types (src/lib/types/slide.ts)**
- Slide interface (minimal: id, layout, content)
- SlideContent type (map of zone name â†’ string content)
- **Write tests:** Type compilation tests

### Core: Design Token Registry

âœ… **Implement TokenRegistry (src/lib/design-system/token-registry.ts)**
- Class to hold token definitions
- Methods: `registerTokens(tokens)`, `getTokens()`
- Store tokens in private Map
- **Write tests:**
  - Test token registration
  - Test token retrieval
  - Test overwriting tokens

âœ… **Create default tokens (src/lib/design-system/default-tokens.ts)**
- Default color palette (8 colors minimum)
- Default typography (2 font families, 4 sizes)
- Default spacing scale (4px base: 4, 8, 16, 24, 32, 48)
- Export as `defaultTokens` object
- **Write tests:**
  - Test all token categories exist
  - Test token values are valid CSS

### Core: Theme System

âœ… **Implement Theme class (src/lib/theming/theme.ts)**
- Constructor accepts DesignTokens
- Method: `getTokens()` returns tokens
- Method: `getCSSVariables()` returns CSS custom properties
- **Write tests:**
  - Test theme creation
  - Test token retrieval
  - Test CSS variable generation

âœ… **Create example theme (src/lib/theming/example-theme.ts)**
- Create one example theme using default tokens
- Override 2-3 colors to demonstrate theming
- Export as `exampleTheme`
- **Write tests:**
  - Test theme has all required tokens
  - Test theme overrides work correctly

### Core: Layout System

âœ… **Implement LayoutRegistry (src/lib/design-system/layout-registry.ts)**
- Class to register and retrieve layouts
- Methods: `registerLayout(name, definition)`, `getLayout(name)`
- Store layouts in Map
- **Write tests:**
  - Test layout registration
  - Test layout retrieval
  - Test error on unknown layout

âœ… **Define "title" layout (src/lib/design-system/layouts/title.ts)**
- Zones: "title", "subtitle"
- CSS grid-based positioning
- Export layout definition
- Register in default registry
- **Write tests:**
  - Test layout has correct zones
  - Test layout can be retrieved

### Core: Slide Renderer

âœ… **Implement SlideRenderer (src/lib/rendering/slide-renderer.ts)**
- Method: `render(slide, theme)` â†’ HTML string
- Apply layout based on slide.layout
- Inject content into layout zones
- Inject theme CSS variables
- **Write tests:**
  - Test slide renders to HTML
  - Test theme CSS variables are applied
  - Test content appears in correct zones

### Demo Application

âœ… **Create index.html (root)**
- Basic HTML5 structure
- Load main.ts as module
- Include div#app container
- **Write tests:** N/A (static HTML)

âœ… **Create main.ts (src/main.ts)**
- Import SlideRenderer, exampleTheme, titleLayout
- Create a sample slide object
- Render slide to HTML
- Inject into DOM
- **Write tests:** Integration test for full rendering

âœ… **Add basic styles (src/styles.css)**
- CSS reset
- Full-page slide display
- Apply theme CSS variables
- **Write tests:** N/A (visual verification)

### Validation

âœ… **Manual verification**
- Run `npm run dev`
- Open http://localhost:5173
- Verify slide renders with themed colors/fonts
- **Write tests:** Visual inspection checklist
- **Status:** âœ… Dev server ran successfully at http://localhost:5173

**Phase 1 Status: âœ… Complete** - All tasks completed and verified.

---

## Phase 2: Multi-Slide Navigation

**Goal:** Navigate between multiple slides using keyboard/clicker controls. Proves the presentation flow works.

**Deliverable:** A presentation with 3-5 slides that can be navigated with arrow keys and progress tracked.

### Type Definitions

âœ… **Define Deck types (src/lib/types/deck.ts)**
- Deck interface (metadata, theme, slides array)
- DeckMetadata interface (title, author)
- Export from types/index.ts
- **Write tests:** Type validation via TypeScript build

### Core: Deck Management

âœ… **Implement DeckNavigator (src/lib/navigation/deck-navigator.ts)**
- Track current slide index
- Methods: `next()`, `previous()`, `goToSlide(index)`, `getCurrentSlide()`
- Emit navigation events
- Handle boundary conditions (first/last slide)
- **Write tests:** 24 tests covering navigation, events, and boundaries

âœ… **Implement NavigationController (src/lib/navigation/navigation-controller.ts)**
- Listen for keyboard events (Arrow keys, Space, Page Up/Down)
- Delegate to DeckNavigator
- Support clicker devices (standard presenter remotes map to arrow keys)
- Bonus: Home/End key support for jumping to first/last slide
- **Write tests:** 20 tests covering keyboard events, enable/disable, and presenter remote support

### Core: Deck Renderer

âœ… **Implement DeckRenderer (src/lib/rendering/deck-renderer.ts)**
- Method: `render(deck)` â†’ sets up presentation container
- Manages multiple slide instances
- Integrates with NavigationController
- Updates DOM on slide change
- Shows current slide, hides others
- **Write tests:** 20 tests covering rendering, navigation integration, layout, and lifecycle

### UI: Progress Indicator

âœ… **Implement ProgressIndicator component (src/lib/ui/progress-indicator.ts)**
- Shows "Slide X of Y" or progress bar
- Updates on navigation events
- Configurable position and style
- Three display styles: text, bar, dots
- Six position options: top, bottom, top-left, top-right, bottom-left, bottom-right
- **Write tests:** 25 tests covering all styles, positions, navigation updates, and lifecycle

### Demo Application

âœ… **Create multi-slide demo (src/main.ts)**
- Define a deck with 3-5 slides using different layouts
- Initialize DeckRenderer with deck
- Demonstrate navigation between slides
- Added ProgressIndicator to show slide counter
- Console logs navigation instructions
- **Write tests:** N/A (demo application)

âœ… **Update index.html and styles**
- Full-screen slide container with absolute positioning
- Slide transition CSS with 0.3s fade effect
- Progress indicator styling with backdrop blur and semi-transparent background
- CSS custom properties integration for theming
- **Write tests:** N/A (presentational CSS/HTML)

### Validation

âœ… **Manual verification**
- Arrow keys navigate forward/backward
- Space advances slides
- First/last slide boundaries work correctly
- Progress indicator updates
- All slides render with theme applied
- Dev server runs successfully at http://localhost:5173
- **Write tests:** N/A (manual verification)

**Phase 2 Status: âœ… Complete** - All tasks completed and verified. Dev server tested successfully.

---

## Phase 3: Core Layouts

**Goal:** Add essential layout templates for common presentation patterns. Focuses on foundational layouts that cover 80% of use cases.

**Deliverable:** 4 core layouts that enable structured content presentations.

### Layout Implementations

- [x] **Define "section" layout (src/lib/design-system/layouts/section.ts)**
  - Section divider for talk structure
  - Zones: "heading" (large, centered)
  - Full-bleed background color support
  - Register in layout registry
  - **Write tests:** Layout structure, zone definitions, registration

- [x] **Define "content" layout (src/lib/design-system/layouts/content.ts)**
  - Single content area with title
  - Zones: "title", "content"
  - Balanced padding and spacing
  - Register in layout registry
  - **Write tests:** Layout structure, zone definitions, registration

- [x] **Define "two-column" layout (src/lib/design-system/layouts/two-column.ts)**
  - Equal-width two-column layout
  - Zones: "title", "left", "right"
  - CSS grid with 50/50 split
  - Register in layout registry
  - **Write tests:** Layout structure, zone definitions, registration

- [x] **Define "code" layout (src/lib/design-system/layouts/code.ts)**
  - Optimized for code display
  - Zones: "title", "code"
  - Larger code area with minimal chrome
  - Register in layout registry
  - **Write tests:** Layout structure, zone definitions, registration

### Demo & Validation

- [x] **Update demo (src/main.ts)**
  - Create slides demonstrating all 5 layouts (title + 4 new)
  - Show content flowing into zones correctly
  - **Write tests:** N/A (demo application)

- [x] **Manual verification**
  - All layouts render correctly
  - Content fits in zones as expected
  - Layouts respond to theme changes
  - **Write tests:** N/A (visual verification)
  - **Status:** âœ… Dev server runs successfully at http://localhost:5175

**Phase 3 Status: âœ… Complete** - All 4 core layouts implemented, demo updated, and verified.

---

## Phase 4: Advanced Layouts

**Goal:** Add specialized layout templates for richer presentations. These layouts handle complex content arrangements and visual hierarchy.

**Deliverable:** 6 advanced layouts that enable sophisticated content presentations.

### Layout Implementations

- [x] **Define "image-left" layout (src/lib/design-system/layouts/image-left.ts)**
  - Image on left, content on right
  - Zones: "title", "image", "content"
  - CSS grid with 40/60 split (image/content)
  - Register in layout registry
  - **Write tests:** Layout structure, zone definitions, registration

- [x] **Define "image-right" layout (src/lib/design-system/layouts/image-right.ts)**
  - Image on right, content on left
  - Zones: "title", "content", "image"
  - CSS grid with 60/40 split (content/image)
  - Register in layout registry
  - **Write tests:** Layout structure, zone definitions, registration

- [x] **Define "split-40-60" layout (src/lib/design-system/layouts/split-40-60.ts)**
  - Asymmetric two-column layout
  - Zones: "title", "left", "right"
  - CSS grid with 40/60 split for emphasis
  - Register in layout registry
  - **Write tests:** Layout structure, zone definitions, registration

- [x] **Define "split-60-40" layout (src/lib/design-system/layouts/split-60-40.ts)**
  - Asymmetric two-column layout (inverse)
  - Zones: "title", "left", "right"
  - CSS grid with 60/40 split for emphasis
  - Register in layout registry
  - **Write tests:** Layout structure, zone definitions, registration

- [x] **Define "quote" layout (src/lib/design-system/layouts/quote.ts)**
  - Large quote with attribution
  - Zones: "quote", "attribution"
  - Centered, large text for impact
  - Register in layout registry
  - **Write tests:** Layout structure, zone definitions, registration

- [x] **Define "comparison" layout (src/lib/design-system/layouts/comparison.ts)**
  - Side-by-side comparison with labels
  - Zones: "title", "left-label", "left", "right-label", "right"
  - CSS grid for structured comparison (vs. slides)
  - Register in layout registry
  - **Write tests:** Layout structure, zone definitions, registration

### Demo & Validation

- [x] **Update demo (src/main.ts)**
  - Create slides demonstrating all 6 new layouts
  - Show content flowing into zones correctly
  - Mix with existing layouts for comprehensive showcase
  - **Write tests:** N/A (demo application)

- [x] **Manual verification**
  - All layouts render correctly
  - Content fits in zones as expected
  - Asymmetric splits display properly
  - Layouts respond to theme changes
  - **Write tests:** N/A (visual verification)
  - **Status:** âœ… Dev server runs successfully at http://localhost:5173

**Phase 4 Status: âœ… Complete** - All 6 advanced layouts implemented, demo updated, and verified.

---

## Phase 5: Debug Mode (CURRENT)

**Goal:** Implement visual overlay system that displays layout info, design tokens, zone boundaries, and slide metadata to aid development.

**Deliverable:** Working debug mode that can be toggled via keyboard shortcut, showing all key framework internals.

### Type Definitions

- [x] **Define DebugInfo types (src/lib/types/debug.ts)**
  - DebugInfo interface (slide, layout, theme, content data)
  - DebugOptions interface (configuration options)
  - DebugPanelPosition type
  - Export from types/index.ts
  - **Write tests:** Type validation via TypeScript build

### Core: Debug Data Collection

- [x] **Implement DebugDataCollector (src/lib/debug/debug-data-collector.ts)**
  - Method: `collectSlideDebugInfo(slide, layout, theme)` â†’ DebugInfo
  - Extract layout metadata (name, zones, grid config)
  - Extract theme data (name, tokens, overrides)
  - Map content to zones with metadata
  - **Write tests:** Test data collection for various slide/layout/theme combinations

### Core: Debug Mode Manager

- [x] **Implement DebugMode class (src/lib/debug/debug-mode.ts)**
  - Track enabled/disabled state
  - Store debug options configuration
  - Persist state to localStorage
  - Emit debug state change events
  - Methods: `enable()`, `disable()`, `toggle()`, `isEnabled()`
  - **Write tests:** Test state management, localStorage persistence, events

### UI: Debug Overlay Container

- [x] **Implement DebugOverlay component (src/lib/debug/debug-overlay.ts)**
  - Create overlay container DOM structure
  - Position as fixed layer above slides
  - Manage lifecycle (mount/unmount)
  - Coordinate all debug panels
  - **Write tests:** Test DOM structure, positioning, lifecycle

### UI: Layout Info Panel

- [x] **Implement LayoutInfoPanel component (src/lib/debug/panels/layout-info-panel.ts)**
  - Display layout name, zones, grid configuration
  - Position in configurable corner
  - Update on slide change
  - Collapsible panel
  - **Write tests:** Test rendering, positioning, updates

### UI: Zone Boundaries Overlay

- [x] **Implement ZoneBoundaries component (src/lib/debug/panels/zone-boundaries.ts)**
  - Draw colored borders around each layout zone
  - Show zone name labels
  - Color-code zones (different color per zone)
  - Update zone positions on slide change
  - **Write tests:** Test zone detection, boundary rendering, color assignment

### UI: Design Token Inspector

- [x] **Implement TokenInspector component (src/lib/debug/panels/token-inspector.ts)**
  - Display all active design tokens (colors, typography, spacing)
  - Organize by token category (collapsible sections)
  - Show computed CSS variable values
  - Highlight overridden tokens
  - Click to copy token name/value
  - **Write tests:** Test token display, categorization, copy functionality

### UI: Slide Metadata Panel

- [x] **Implement MetadataPanel component (src/lib/debug/panels/metadata-panel.ts)**
  - Show slide number, ID, layout name
  - Display zone population status (filled vs total)
  - Update on navigation
  - **Write tests:** Test metadata display, navigation updates

### Integration: Keyboard Controls

- [x] **Implement DebugKeyboardController (src/lib/debug/debug-keyboard-controller.ts)**
  - Listen for 'D' key to toggle debug mode
  - Listen for 'Shift+D' to toggle specific panels
  - Listen for 'Alt+Z' for zone boundaries only
  - Listen for 'Alt+T' for token inspector only
  - Enable/disable listeners
  - **Write tests:** Test keyboard event handling, enable/disable

### Integration: DeckRenderer Debug Support

- [x] **Update DeckRenderer to support debug mode**
  - Add debug mode option to constructor
  - Initialize DebugOverlay when enabled
  - Pass debug data to overlay on slide changes
  - Wire up keyboard controller
  - **Write tests:** Test debug mode integration, data passing

### Styling

- [x] **Create debug mode styles (src/lib/debug/debug.css)**
  - Overlay container styles (fixed positioning, z-index)
  - Panel styles (dark semi-transparent background, monospace font)
  - Zone boundary styles (dashed borders, labels)
  - Token inspector styles (collapsible sections, copy buttons)
  - Responsive adjustments
  - **Write tests:** N/A (visual styles)

### Demo & Validation

- [x] **Update demo to showcase debug mode (src/main.ts)**
  - Enable debug mode option
  - Add console instructions for keyboard shortcuts
  - Demonstrate toggling debug overlays
  - **Write tests:** N/A (demo application)

- [x] **Manual verification**
  - Press 'D' to toggle debug mode on/off
  - Verify layout info panel shows correct data
  - Verify zone boundaries appear around zones
  - Verify token inspector shows all tokens
  - Verify metadata panel updates on navigation
  - Navigate between slides and verify debug data updates
  - Test localStorage persistence (refresh page)
  - **Write tests:** N/A (manual verification)
  - **Status:** âœ… Dev server running successfully at http://localhost:5173

**Phase 5 Status: âœ… Complete** - All tasks completed and verified.

---

## Phase 6: Deck-Specific Custom Layouts

**Goal:** Enable individual decks to define their own custom layouts for unique presentation needs, implementing the three-tier layout hierarchy (system â†’ theme â†’ deck).

**Deliverable:** Working system that allows decks to define, register, and use custom layouts that override theme/system layouts.

### Type Definitions

- [x] **Update layout types (src/lib/types/layout.ts)**
  - Add LayoutSource enum: 'system' | 'theme' | 'deck'
  - Add source property to LayoutDefinition
  - Add priority/specificity for layout resolution
  - **Write tests:** Type validation via TypeScript build

- [x] **Update deck types (src/lib/types/deck.ts)**
  - Add customLayouts property to Deck interface
  - Define CustomLayoutDefinition type
  - Support layout composition/extension
  - **Write tests:** Type validation via TypeScript build

### Core: Layout Resolution System

- [x] **Implement LayoutResolver (src/lib/design-system/layout-resolver.ts)**
  - Method: `resolveLayout(name, deckLayouts, themeLayouts)` â†’ LayoutDefinition
  - Implement three-tier resolution: deck â†’ theme â†’ system
  - Support layout inheritance (extend existing layouts)
  - Cache resolved layouts for performance
  - **Write tests:** Test resolution order, inheritance, caching

- [x] **Update LayoutRegistry for hierarchy support**
  - Add methods: `registerDeckLayouts()`, `registerThemeLayouts()`
  - Maintain separate registries by source
  - Clear deck layouts on deck change
  - **Write tests:** Test multi-source registration, clearing

### Core: Custom Layout Definition

- [x] **Implement CustomLayoutBuilder (src/lib/design-system/custom-layout-builder.ts)**
  - Helper methods for defining layouts in decks
  - Support extending existing layouts
  - Support composing layouts from multiple sources
  - Validate zone definitions
  - **Write tests:** Test layout building, extension, composition

- [x] **Create layout composition utilities (src/lib/design-system/layout-utils.ts)**
  - mergeLayouts() - combine layouts preserving zones
  - extendLayout() - add zones to existing layout
  - overrideLayout() - replace specific zones
  - **Write tests:** Test merge, extend, override operations

### Core: Deck Integration

- [x] **Update DeckRenderer for custom layouts**
  - Accept customLayouts in deck definition
  - Register deck layouts with resolver
  - Clear deck layouts on deck change
  - **Write tests:** Test custom layout rendering, cleanup

- [x] **Update SlideRenderer for layout resolution**
  - Use LayoutResolver instead of direct registry lookup
  - Pass deck context for resolution
  - **Write tests:** Test resolution in rendering context

### Theme Integration

- [x] **Update Theme class for layout support**
  - Add layouts property to Theme interface
  - Method: `getLayouts()` returns theme-specific layouts
  - **Write tests:** Test theme layout retrieval

- [x] **Update example theme with custom layout**
  - Define one theme-specific layout variant
  - Demonstrate theme-level customization
  - **Write tests:** Test theme layout registration

### Demo: Custom Layout Showcase

- [x] **Create example deck with custom layouts**
  - Define 2-3 deck-specific layouts
  - One that extends a system layout (title-with-tagline extends title)
  - One that's completely custom (three-column-data)
  - One that extends a system layout (content-with-sidebar extends content)
  - **Write tests:** N/A (demo application)

- [x] **Update main.ts demo**
  - Create deck with custom layouts (customLayouts property added)
  - Show layout resolution in action (5 new slides demonstrating custom layouts)
  - Demonstrate all three tiers working together (slides 12-16)
  - **Write tests:** N/A (demo application)

### Documentation

- [x] **Create layout authoring guide**
  - How to define custom layouts in a deck
  - Layout extension patterns (extends, composeFrom, custom)
  - Zone naming conventions (standard and custom)
  - Best practices for maintainability
  - **Write tests:** N/A (documentation)
  - **Location:** specs/custom-layouts.md

### Validation

- [x] **Manual verification**
  - âœ… Custom deck layouts render correctly (slides 12-16)
  - âœ… Layout resolution order works (deck â†’ theme â†’ system)
  - âœ… Extended layouts preserve base functionality (title-with-tagline, content-with-sidebar)
  - âœ… Custom layouts are scoped to their deck (customLayouts array)
  - âœ… Theme layouts work across all decks (debugging-leadership layouts)
  - **Write tests:** N/A (manual verification)
  - **Verified:** Dev server running at http://localhost:5174/, all layouts rendering

**Phase 6 Status:** âœ… Complete - All tasks completed and verified

---

## Phase 7: Reusable Components (CURRENT)

**Goal:** Build reusable presentation components that work across all layouts and themes.

**Deliverable:** Component library with code blocks, lists, callouts, and images that can be used in any slide.

- [x] **Define component types (src/lib/types/component.ts)** - Component interface, CodeBlock, List, Callout, Image types
- [x] **Implement ComponentRegistry (src/lib/components/component-registry.ts)** - Register and resolve component renderers by type
- [x] **Implement ComponentRenderer (src/lib/components/component-renderer.ts)** - Render components to HTML with theme token support
- [x] **Implement CodeBlock component (src/lib/components/code-block.ts)** - Syntax highlighting, line numbers, line highlighting, copy button
- [ ] **Implement List component (src/lib/components/list.ts)** - Bullet, numbered, checklist variants with nesting
- [ ] **Implement Callout component (src/lib/components/callout.ts)** - Info, warning, success, error types with themed colors
- [ ] **Implement Image component (src/lib/components/image.ts)** - Fit modes (contain/cover/original), lazy loading, captions
- [ ] **Update SlideRenderer for components** - Detect component markup, render using ComponentRenderer, pass theme tokens
- [ ] **Create component showcase demo** - One slide per component type demonstrating all variants
- [ ] **Manual verification** - Test all components render correctly, syntax highlighting works, theming applies

**Phase 7 Status:** ðŸš§ Not started

---

## Future Work

- Phase 8: Presenter View - Dual-monitor support with notes, timer, next slide preview
- Phase 9: Animations - Build animations, slide transitions, timing control
- Phase 10: Media - Images, videos, audio with proper handling
- Phase 11: Talk Variants - Audience-specific versions (technical vs exec, short vs full)
- Phase 12: URL Navigation - Deep linking, browser back/forward
- Phase 13: Slide Authoring Format - Declarative format for writing slides (vs TypeScript objects)
- Phase 14: Talk Metadata - CFP-optimized metadata system
